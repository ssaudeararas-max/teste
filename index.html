<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Emendas â€” SaÃºde</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f1f8f6;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #0b6e4f;
      margin-bottom: 30px;
    }

    .card {
      background-color: #ffffff;
      border-left: 6px solid #0b6e4f;
      border-radius: 10px;
      padding: 18px 22px;
      margin-bottom: 22px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .emenda {
      font-size: 22px;
      font-weight: bold;
      color: #084c3a;
      margin-bottom: 12px;
    }

    .linha {
      margin: 4px 0;
      font-size: 15px;
    }

    .label {
      font-weight: bold;
      color: #0b6e4f;
    }

    .valor {
      font-weight: bold;
      color: #1a7f5a;
    }

    .status {
      font-weight: bold;
      padding: 3px 8px;
      border-radius: 6px;
      display: inline-block;
    }

    .status.aprovada { background-color: #d1fae5; color: #065f46; }
    .status.em_execucao { background-color: #e0f2fe; color: #075985; }
    .status.pendente { background-color: #fef3c7; color: #92400e; }
    .status.cancelada { background-color: #fee2e2; color: #991b1b; }
  </style>
</head>
<body>

<h1>ðŸ“‹ Painel de Emendas â€” SaÃºde</h1>
<div id="dados">Carregando dados...</div>

<script>
const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYQEy_Zi7Xl7J3tFyWO7rKe-_q7k9gT3pnURWTEGEE5xbhEhNYDiz7dQYqBoW7uVg57PKy3ERY_vfv/pub?gid=0&single=true&output=csv";

function formatarMoeda(valor) {
  if (!valor) return "-";
  const numero = valor.replace(/[^\d,.-]/g, "").replace(",", ".");
  if (isNaN(numero)) return valor;
  return Number(numero).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

async function atualizar() {
  try {
    const resposta = await fetch(url);
    const texto = await resposta.text();

    const separador = texto.includes(";") ? ";" : ",";
    const linhas = texto.trim().split("\n");

    const cabecalhos = linhas[0].split(separador).map(c => c.replace(/^"|"$/g, "").trim());

    let html = "";

    linhas.slice(1).forEach(linha => {
      const colunas = linha.split(separador).map(c => c.replace(/^"|"$/g, "").trim());
      const dados = Object.fromEntries(cabecalhos.map((h, i) => [h, colunas[i] || "-"]));

      const statusClasse = (dados["STATUS"] || "").toLowerCase()
        .replace(/\s+/g, "_")
        .replace(/[^\w]/g, "");

      html += `
        <div class="card">
          <div class="emenda">ðŸ§¾ Emenda: ${dados["EMENDA"] || "-"}</div>

          <div class="linha"><span class="label">NÂ° Proposta:</span> ${dados["NÂ° PROPOSTA"]}</div>
          <div class="linha"><span class="label">Destino:</span> ${dados["DESTINO"]}</div>
          <div class="linha"><span class="label">Parlamentar:</span> ${dados["PARLAMENTAR"]}</div>
          <div class="linha"><span class="label">Funcional:</span> ${dados["FUNCIONAL"]}</div>
          <div class="linha"><span class="label">Conta:</span> ${dados["CONTA"]}</div>
          <div class="linha"><span class="label">Tipo de Emenda:</span> ${dados["TIPO DE EMENDA"]}</div>
          <div class="linha"><span class="label">UtilizaÃ§Ã£o:</span> ${dados["UTILIZAÃ‡ÃƒO"]}</div>
          <div class="linha"><span class="label">Eixo:</span> ${dados["EIXO"]}</div>
          <div class="linha"><span class="label">Subcategoria:</span> ${dados["SUBCATEGORIA"]}</div>
          <div class="linha"><span class="label">Natureza de Despesa:</span> ${dados["NATUREZA DE DESPEZA"]}</div>
          <div class="linha"><span class="label">DiligÃªncias:</span> ${dados["DILIGÃŠNCIAS"]}</div>

          <div class="linha"><span class="label">Valor Indicado:</span> <span class="valor">${formatarMoeda(dados["VALOR INDICADO"])}</span></div>
          <div class="linha"><span class="label">Valor Priorizado:</span> <span class="valor">${formatarMoeda(dados["VALOR PRIORIZADO"])}</span></div>
          <div class="linha"><span class="label">Valor Utilizado:</span> <span class="valor">${formatarMoeda(dados["VALOR UTILIZADO"])}</span></div>
          <div class="linha"><span class="label">Saldo:</span> <span class="valor">${formatarMoeda(dados["SALDO"])}</span></div>

          <div class="linha">
            <span class="label">Status:</span>
            <span class="status ${statusClasse}">${dados["STATUS"]}</span>
          </div>
        </div>
      `;
    });

    document.getElementById("dados").innerHTML = html || "Nenhum dado encontrado.";
  } catch (erro) {
    document.getElementById("dados").innerHTML = "Erro ao carregar dados.";
    console.error(erro);
  }
}

setInterval(atualizar, 5000);
atualizar();
</script>

</body>
</html>
